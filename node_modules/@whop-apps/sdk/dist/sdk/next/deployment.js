"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "createPreviewDeployment", {
    enumerable: true,
    get: function() {
        return createPreviewDeployment;
    }
});
async function createPreviewDeployment() {
    try {
        const token = process.env.WHOP_API_KEY;
        const title = process.env.VERCEL_GIT_COMMIT_REF;
        const branchUrl = process.env.VERCEL_BRANCH_URL;
        if (!token) {
            // biome-ignore lint/suspicious/noConsoleLog: Make Build Logs More Helpful
            console.log("Skipping Deployment Creation: Missing Whop API key");
            return;
        }
        if (!(branchUrl && title)) {
            // biome-ignore lint/suspicious/noConsoleLog: Make Build Logs More Helpful
            console.log("Skipping Deployment Creation: Missing branch URL or title", {
                branchUrl,
                title
            });
            return;
        }
        const origin = new URL(`https://${branchUrl}`).origin;
        const deployment = await fetch("https://app-proxy.apps.whop.com/_whop/deployments", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`
            },
            body: JSON.stringify({
                title,
                origin
            })
        }).then((res)=>res.json()).catch((err)=>{
            // biome-ignore lint/suspicious/noConsoleLog: Make Build Logs More Helpful
            console.log("Error creating Whop deployment");
            console.error(err);
            return null;
        });
        if (deployment) {
            // biome-ignore lint/suspicious/noConsoleLog: Make Build Logs More Helpful
            console.log("Whop Deployment Created", deployment);
            return deployment.hash;
        }
        // biome-ignore lint/suspicious/noConsoleLog: Make Build Logs More Helpful
        console.log("Failed to create Whop deployment");
    } catch (error) {
        console.error("Error creating Whop deployment", error);
    }
}
