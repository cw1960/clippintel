"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "initOAuth", {
    enumerable: true,
    get: function() {
        return initOAuth;
    }
});
const _core = require("@whop-apps/core");
const _iframe = require("@whop-apps/iframe");
async function initOAuth({ provider, scope, restPath }) {
    const appId = _core.WhopEnvStore.get(_core.WhopEnv.APP_ID);
    const sdk = (0, _iframe.createAppIframeSDK)({
        appId
    });
    const { baseHref } = await sdk.getTopLevelUrlData({});
    const fullUrl = new URL(baseHref + (restPath?.replace(/^\//, "") ?? ""));
    const pathname = encodeURIComponent(fullUrl.pathname + fullUrl.search);
    // Redirect to OAuth API
    const redirectUrl = new URL(`/_whop/oauth/oauth/${provider}/init`, window.location.origin);
    if (scope) redirectUrl.searchParams.set("scope", scope);
    redirectUrl.searchParams.set("redirect", pathname);
    await sdk.openExternalUrl({
        url: redirectUrl.toString()
    });
}
